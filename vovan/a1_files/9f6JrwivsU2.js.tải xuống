if (self.CavalryLogger) { CavalryLogger.start_js(["Wbfwx"]); }

__d("MReactionUnitViewportTracking",["DOM","MarauderLogger","MLegacyDataStore","MViewportTracking","Stratcom","ge"],(function(a,b,c,d,e,f){"use strict";var g="reaction-unit-logging",h=function(c){babelHelpers.inheritsLoose(a,c);function a(){return c.apply(this,arguments)||this}var d=a.prototype;d.getDataFromConfig=function(a){this.$MReactionUnitViewportTracking1=[b("Stratcom").listen("m:jewel:flyout:open",null,function(a){a.getData().jewel==="notifications"&&this.startRecordingTimeTrackingData()}.bind(this)),b("Stratcom").listen("m:jewel:flyout:close",null,function(a){a.getData().jewel==="notifications"&&this.stopRecordingTimeTrackingData()}.bind(this)),b("Stratcom").listen("unload",null,function(){this.stopRecordingTimeTrackingData()}.bind(this))],this.isTimeTrackingEnabled=!0};d.getAllStories=function(){var a=b("ge")("notifications_flyout");return!a?[]:b("DOM").scry(a,"div",g)};d.getTimeout=function(){return 1};d.getDataToLog=function(a){return b("MLegacyDataStore").get(a).logging_data};d.getMinSizeToBeVisible=function(a){return 0};d.getStoryID=function(a){return a.id};d.getTimetrackingDataToLog=function(a){var c={};Object.assign(c,b("MLegacyDataStore").get(a.story).logging_data);c.unit_type=c.interacted_story_type;delete c.interacted_story_type;c.first_appear_time=a.evp_ts/1e3;c.vpvd_time_delta=Math.round(a.vpvd);var d=this.getAllStories();c.unit_count=d.length;c.unit_position=d.indexOf(a.story);return c};d.sendDataToLog=function(a){if(!a.vpvd_time_delta)return;b("MarauderLogger").log("reaction_unit_impression","reaction_units",a)};d.onUnload=function(){this.startRecordingTimeTrackingData()};return a}(b("MViewportTracking"));e.exports.init=function(a){new h().init(a)}}),null);
__d("MReactionLogging",["MarauderLogger","MLegacyDataStore","MReactionUnitViewportTracking","Stratcom"],(function(a,b,c,d,e,f){var g="reaction_logging",h=[];function a(a){b("MReactionUnitViewportTracking").init(a);if(h.length)return;h=[b("Stratcom").listen("click",g,function(a){a=a.getNode(g);a instanceof HTMLElement&&i(a)}),b("Stratcom").listen("reaction-unit-expiration",null,function(a){b("MarauderLogger").log("reaction_unit_did_timeout","reaction_units",a.getData())})]}function i(a){a=b("MLegacyDataStore").get(a).logging_data;b("MarauderLogger").log("reaction_unit_interaction","guide_cards_null_state",a)}e.exports={init:a}}),null);
__d("XTodayReactionController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/ajax/today/reaction/",{cursor:{type:"String"},id:{type:"String"},lat:{type:"Float"},"long":{type:"Float"}})}),null);
__d("MReactionUnitExpirations",["MLocationPrompt","MRequest","Stratcom","XTodayReactionController","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f){var g={},h=[],i=1e3*60*10;function a(){if(h.length)return;h=[b("Stratcom").listen(b("MLocationPrompt").STRATCOM_UPDATE,null,function(a){k(a.getData().position.coords)})];b("setTimeoutAcrossTransitions")(j,i)}function c(a,c,d){g[a]={unit_type:d,expiration:c},c.radius&&b("MLocationPrompt").getCoords()&&l(a,b("MLocationPrompt").getCoords())}function j(){var a=Date.now()/1e3;for(var c in g)a>g[c].expiration.timestamp&&m(c);b("setTimeoutAcrossTransitions")(j,i)}function k(a){if(!a||a.latitude===void 0||a.longitude===void 0)return;for(var b in g)l(b,a)}function l(a,b){var c=g[a].expiration;c.radius&&n(c.latitude,c.longitude,b.latitude,b.longitude)>c.radius&&m(a)}function m(a){var c=b("XTodayReactionController").getURIBuilder().setString("id",a),d=b("MLocationPrompt").getCoords();d&&c.setFloat("lat",d.latitude).setFloat("long",d.longitude);b("Stratcom").invoke("reaction-unit-expiration",null,{unit_type:g[a].unit_type});new(b("MRequest"))(c.getURI().toString()).send();delete g[a]}function n(a,b,c,d){var e=6371e3,f=o(c-a);d=o(d-b);b=Math.sin(f/2)*Math.sin(f/2)+Math.cos(o(a))*Math.cos(o(c))*Math.sin(d/2)*Math.sin(d/2);f=2*Math.atan2(Math.sqrt(b),Math.sqrt(1-b));a=e*f;return a}function o(a){return a*(Math.PI/180)}e.exports={init:a,updateUnitExpiration:c}}),null);